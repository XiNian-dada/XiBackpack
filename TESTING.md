# 测试指南

## 本地运行测试

### 前置条件
- Java 8 或更高版本
- Maven 3.6 或更高版本

### 运行所有测试
```bash
mvn test
```

### 运行特定测试类
```bash
mvn test -Dtest=TeamBackpackTest
```

### 运行特定测试方法
```bash
mvn test -Dtest=TeamBackpackTest#testCreateTeamBackpack
```

### 构建并运行测试
```bash
mvn clean test
```

### 只编译不运行测试
```bash
mvn compile
```

## CI/CD 配置

项目已配置 GitHub Actions CI/CD，会在以下情况下自动运行测试：

1. **推送到主分支**：当代码推送到 `main` 或 `master` 分支时
2. **Pull Request**：当创建或更新 Pull Request 时
3. **Release 创建**：当创建新的 Release 时

### CI/CD 工作流

CI/CD 工作流包含以下步骤：

1. **检出代码**：从 GitHub 仓库检出最新代码
2. **设置 JDK 8**：配置 Java 8 环境
3. **构建项目**：使用 Maven 编译项目
4. **运行测试**：执行所有单元测试
5. **打包项目**：生成最终的 JAR 文件
6. **上传构件**：将 JAR 文件作为 Artifact 上传

### 查看 CI/CD 结果

在 GitHub 仓库的 **Actions** 选项卡中可以查看 CI/CD 运行结果，包括：
- 测试通过/失败情况
- 构建日志
- 生成的 JAR 文件

## 测试结构

### 测试基类
- `TestBase.java`：提供通用测试工具方法，包括模拟服务器设置和清理

### 团队背包测试
- `TeamBackpackTest.java`：测试团队背包的核心功能
  - 创建团队背包（有效和无效名称）
  - 打开团队背包
  - 所有者管理权限
  - 多个团队背包

### 个人背包测试
- `BackpackTest.java`：测试个人背包的核心功能
  - 打开个人背包
  - 背包分页功能
  - 多个玩家背包独立性
  - 背包持久化

## 添加新测试

1. **创建测试类**：继承 `TestBase` 类
2. **添加测试方法**：使用 `@Test` 注解标记
3. **使用断言**：使用 JUnit 5 的断言方法验证结果
4. **使用模拟对象**：使用 MockBukkit 提供的模拟对象进行测试
5. **测试异步任务**：使用 `waitForAsyncTasks()` 方法等待异步任务完成

## 测试最佳实践

1. **保持测试独立**：每个测试方法应该测试一个独立的功能
2. **使用描述性名称**：测试方法名称应该清晰描述测试内容
3. **添加断言**：确保每个测试都有明确的断言
4. **清理资源**：使用 `@AfterEach` 注解清理测试资源
5. **测试边界情况**：测试有效和无效输入
6. **测试异常情况**：确保代码在异常情况下表现正确

## 常见问题

### 测试运行缓慢
- 原因：MockBukkit 模拟服务器启动和停止需要时间
- 解决方案：尽量复用测试资源，减少测试方法数量

### 测试失败
- 查看详细日志：`mvn test -X` 获取详细调试信息
- 检查异步任务：确保使用 `waitForAsyncTasks()` 等待异步任务完成
- 检查权限设置：确保测试玩家有正确的权限

### Maven 命令不识别
- 确保 Maven 已正确安装并添加到系统 PATH
- 使用完整路径运行 Maven：`/path/to/mvn test`

## 贡献测试

欢迎贡献新的测试用例！请确保：
1. 测试覆盖新功能或未测试的代码路径
2. 遵循现有的测试风格
3. 所有测试都能通过
4. 测试运行时间合理

通过 CI/CD 系统，我们可以确保在发布新版本前，所有测试都能通过，提高软件质量和可靠性。